<!-- ğŸ’ Rails 8 Turbo ìºì‹± ì„¤ì • -->
<% content_for :head do %>
  <meta name="turbo-cache-control" content="max-age=300">
  <meta name="turbo-prefetch" content="true">
<% end %>

<p><strong>Name:</strong> <%= @employee.firstname %> <%= @employee.lastname %></p>
<p><strong>Email:</strong> <%= @employee.email %></p>
<p><strong>Phone:</strong> <%= @employee.phone %></p>
<p><strong>Has Passport:</strong> <%= @employee.has_passport %></p>
<p><strong>Salary:</strong> <%= @employee.salary %></p>
<p><strong>Notes:</strong> <%= @employee.notes %></p>
<p><strong>Birth Date:</strong> <%= @employee.birth_date %></p>
<p><strong>Hire Date:</strong> <%= @employee.hire_date %></p>
<p><strong>Gender:</strong> <%= @employee.gender %></p>

<hr>

<h3>Posts by <%= @employee.firstname %> <%= @employee.lastname %></h3>

<!-- Skeleton Loadingê³¼ ë¹„ë™ê¸° Posts ë¡œë“œ -->
<div id="posts-container">
  <!-- ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© ìƒíƒœ -->
  <div class="skeleton-loading">
    <p style="color: #666; font-style: italic;">í¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    <div style="margin: 10px 0;">
      <div class="skeleton-line" style="height: 20px; background: #f0f0f0; margin: 5px 0; border-radius: 4px; animation: pulse 1.5s ease-in-out infinite;"></div>
      <div class="skeleton-line" style="height: 15px; background: #f0f0f0; margin: 5px 0; border-radius: 4px; width: 80%; animation: pulse 1.5s ease-in-out infinite;"></div>
      <div class="skeleton-line" style="height: 40px; background: #f0f0f0; margin: 10px 0; border-radius: 4px; animation: pulse 1.5s ease-in-out infinite;"></div>
    </div>
    <div style="margin: 10px 0;">
      <div class="skeleton-line" style="height: 20px; background: #f0f0f0; margin: 5px 0; border-radius: 4px; animation: pulse 1.5s ease-in-out infinite;"></div>
      <div class="skeleton-line" style="height: 15px; background: #f0f0f0; margin: 5px 0; border-radius: 4px; width: 70%; animation: pulse 1.5s ease-in-out infinite;"></div>
      <div class="skeleton-line" style="height: 40px; background: #f0f0f0; margin: 10px 0; border-radius: 4px; animation: pulse 1.5s ease-in-out infinite;"></div>
    </div>
  </div>
</div>

<!-- ğŸ’ Turbo Frame with caching -->
<%= turbo_frame_tag "employee-posts", 
    src: posts_employee_path(@employee), 
    loading: :lazy,
    data: { 
      turbo_cache: "true",
      turbo_cache_key: "employee-#{@employee.id}-posts-#{@employee.updated_at.to_i}"
    } do %>
  <!-- ë¡œë”© ì¤‘ì—ëŠ” ìœ„ì˜ skeletonì´ í‘œì‹œë¨ -->
<% end %>

<hr>

<!-- ğŸ’ Turbo Prefetch ë§í¬ë“¤ -->
<%= link_to 'Edit this employee', edit_employee_path(@employee), 
    data: { turbo_prefetch: true } %> |
<%= link_to 'Delete this employee', @employee, 
    data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' } %> |
<%= link_to 'Back', employees_path, 
    data: { turbo_prefetch: true } %>

<style>
@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

/* ğŸ’ Turbo ë¡œë”© ìƒíƒœ ìŠ¤íƒ€ì¼ */
turbo-frame[loading] {
  opacity: 0.6;
  transition: opacity 0.3s ease;
}
</style>

<script>
// ğŸ’ Rails 8 Turbo í–¥ìƒëœ ì´ë²¤íŠ¸ ì²˜ë¦¬
document.addEventListener('turbo:frame-load', function(event) {
  if (event.target.id === 'employee-posts') {
    const skeleton = document.querySelector('.skeleton-loading');
    if (skeleton) {
      skeleton.style.display = 'none';
    }
    
    // ìºì‹œ ìƒíƒœ ë¡œê¹…
    const cacheKey = event.target.dataset.turboCacheKey;
    console.log(`âœ… Posts ë¡œë“œ ì™„ë£Œ - Cache Key: ${cacheKey}`);
  }
});

// Turbo ìºì‹œ íˆíŠ¸ ê°ì§€
document.addEventListener('turbo:before-cache', function() {
  console.log('ğŸ’¾ í˜ì´ì§€ê°€ Turbo ìºì‹œì— ì €ì¥ë¨');
});

document.addEventListener('turbo:load', function() {
  console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ (ìºì‹œ ë˜ëŠ” ì„œë²„)');
});
</script>